<!DOCTYPE html>
<!-- Built with spec-md https://spec-md.com -->
<html>
<head><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"><title>GraphQL Continuations</title>
<style>/** * prism.js default theme for JavaScript, CSS and HTML * Based on dabblet (http://dabblet.com) * @author Lea Verou */ code[class*="language-"], pre[class*="language-"] { 	color: black; 	background: none; 	text-shadow: 0 1px white; 	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; 	font-size: 1em; 	text-align: left; 	white-space: pre; 	word-spacing: normal; 	word-break: normal; 	word-wrap: normal; 	line-height: 1.5; 	-moz-tab-size: 4; 	-o-tab-size: 4; 	tab-size: 4; 	-webkit-hyphens: none; 	-moz-hyphens: none; 	-ms-hyphens: none; 	hyphens: none; } pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection, code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection { 	text-shadow: none; 	background: #b3d4fc; } pre[class*="language-"]::selection, pre[class*="language-"] ::selection, code[class*="language-"]::selection, code[class*="language-"] ::selection { 	text-shadow: none; 	background: #b3d4fc; } @media print { 	code[class*="language-"], 	pre[class*="language-"] { 		text-shadow: none; 	} } /* Code blocks */ pre[class*="language-"] { 	padding: 1em; 	margin: .5em 0; 	overflow: auto; } :not(pre) > code[class*="language-"], pre[class*="language-"] { 	background: #f5f2f0; } /* Inline code */ :not(pre) > code[class*="language-"] { 	padding: .1em; 	border-radius: .3em; 	white-space: normal; } .token.comment, .token.prolog, .token.doctype, .token.cdata { 	color: slategray; } .token.punctuation { 	color: #999; } .token.namespace { 	opacity: .7; } .token.property, .token.tag, .token.boolean, .token.number, .token.constant, .token.symbol, .token.deleted { 	color: #905; } .token.selector, .token.attr-name, .token.string, .token.char, .token.builtin, .token.inserted { 	color: #690; } .token.operator, .token.entity, .token.url, .language-css .token.string, .style .token.string { 	color: #9a6e3a; 	/* This background color was intended by the author of this theme. */ 	background: hsla(0, 0%, 100%, .5); } .token.atrule, .token.attr-value, .token.keyword { 	color: #07a; } .token.function, .token.class-name { 	color: #DD4A68; } .token.regex, .token.important, .token.variable { 	color: #e90; } .token.important, .token.bold { 	font-weight: bold; } .token.italic { 	font-style: italic; } .token.entity { 	cursor: help; }</style>
<style>:root{color:#333;font-family:Cambria,"Palatino Linotype",Palatino,"Liberation Serif",serif;font-size:15px;line-height:1.5;--mono-font-size: 13px;--indent: 1rem;--list-indent: 1.5rem;--dfn-indent: 0rem}@media (min-width: 720px){:root{font-size:17px;--mono-font-size: 15px;--indent: 2rem;--list-indent: 2rem;--dfn-indent: 2rem}}body{margin:3rem 0 3rem}article{margin:0 1rem}@media (min-width: 720px){body{margin:6rem auto 3rem;max-width:800px;padding-left:75px;padding-right:clamp(0px,calc((100vw - 800px) * .25),75px)}}.source-link{display:none}@media screen and (min-width: 720px){.source-link{display:block;position:absolute;width:18px;fill:#ccc;opacity:.3}.source-link:hover{opacity:1}}.outdated-selection-link,.selection-link{position:absolute;display:block;color:#fff;--selection-background-color: #cacee0;background:var(--selection-background-color);border-radius:4px;font-size:36px;height:23px;line-height:48px;text-align:center;text-decoration:none;width:25px;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.outdated-selection-link:hover,.selection-link:hover{text-decoration:none}.outdated-selection-link:before,.selection-link:before{border:5px solid transparent;content:"";height:0;margin-top:-5px;margin-right:-5px;position:absolute;right:1px;top:50%;width:0}@media (max-width: 719px){.outdated-selection-link:before,.selection-link:before{border-bottom-color:var(--selection-background-color);border-top:0;right:50%;top:1px}}@media (min-width: 720px){.outdated-selection-link:before,.selection-link:before{border-left-color:var(--selection-background-color);border-right:0;right:1px;top:50%}}.selection-link:hover{--selection-background-color: #3b5998}.outdated-selection-link{--selection-background-color: #f0babe;font-size:21px;font-weight:800;line-height:27px}.outdated-selection-link:hover:after{content:"This selection content has changed since this link was created.";font:9pt/11pt Cambria,"Palatino Linotype",Palatino,"Liberation Serif",serif;position:absolute;display:block;white-space:nowrap;padding:2px 5px 1px;top:-20px;background:black;color:#fff}a{color:#3b5998;text-decoration:none}a:hover{text-decoration:underline}img{max-width:100%}dl{margin:1rem 0 1rem var(--dfn-indent)}dd{margin:.25em 0 .5em var(--indent)}dd+dd{margin-top:1rem}dfn,.spec-ref{font-style:italic}dfn>a,.spec-ref>a{color:inherit}h1,h2,h3,h4,h5,h6{font-weight:bold;margin:3em 0 1em;position:relative}@media (min-width: 720px){header>h1{margin:6em 0 3em}}h1{font-size:1.5em;margin-top:5em}h2,h3{font-size:1.25em}h4,h5,h6{font-size:1em}section{padding-top:1rem;margin-top:-1rem}section.subsec>h6{margin-top:2em}section.subsec>h6>a{color:#333}section .spec-secid{margin-right:1ex}@media (min-width: 720px){section .spec-secid{position:absolute;right:100%;text-align:right;white-space:nowrap}}footer{font-size:75%;opacity:.5;text-align:center;margin-top:12rem}.spec-toc{margin:1rem 0 3rem}.spec-toc .title{content:"Contents";display:block;font-weight:bold;margin:5em 0 1em}.spec-toc .spec-secid{margin-right:1ex}.spec-toc ol{list-style:none;padding-left:0;margin-top:0;margin-bottom:0}.spec-toc ol ol{list-style:none;padding-left:2ex;margin-bottom:.25em}.spec-toc li{position:relative;padding:5px 0 0 30px;margin:-5px 0 0 -30px}.spec-toc a{color:#333}.spec-toc a:hover{text-decoration:none}.spec-toc a .spec-secid{color:#3b5998}.spec-toc a:hover .spec-secid{text-decoration:underline}.spec-toc .toggle{display:none}.spec-toc .toggle+label{cursor:pointer;left:6px;opacity:1;padding:5px 6px 5px 7px;position:absolute;top:6px;transform:rotate(0deg);transition:all .18s ease-in-out}.spec-toc .toggle+label:after{border-color:transparent transparent transparent #bbc;border-style:solid;border-width:6px 0 6px 7px;content:" ";display:block;height:0;width:0}@media (pointer: fine){.spec-toc .toggle+label{left:10px;padding:3px 5px 3px 6px;top:8px}}.spec-toc .toggle:checked+label{transform:rotate(90deg)}@media (hover: hover){.spec-toc li:not(:hover)>.toggle:checked+label{opacity:0}}.spec-toc .toggle:not(:checked)~ol{max-height:0;overflow:hidden;margin:0}.spec-sidebar-toggle{display:none}.spec-sidebar-toggle+label>.spec-sidebar-button{position:fixed;right:0;top:0;padding:10px 15px;font-size:30px;color:#000000b3;z-index:2;cursor:pointer;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.spec-sidebar-toggle:checked+label:after{content:"";position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0}.spec-sidebar{display:none;position:fixed;right:0;top:0;width:min(320px,calc(100vw - 48px));font-size:14px;line-height:1.75;overflow-y:scroll;height:100%;padding:0 0 5rem 30px;box-sizing:border-box;background:#f0f0f0;box-shadow:inset 1px 0 rgba(0,0,0,.05),-4px 0 8px -2px rgba(0,0,0,.04);overscroll-behavior:contain}.spec-sidebar{user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none}.spec-sidebar-toggle:checked~.spec-sidebar{display:block}.spec-sidebar .viewing>a:after{color:#8b9;content:"\2022";margin-left:1ex}@media (min-width: 1220px){.spec-sidebar-toggle+label{display:none}.spec-sidebar{display:block;box-shadow:inset 1px 0 rgba(0,0,0,.05),inset 4px 0 8px -2px rgba(0,0,0,.08)!important}body{padding-right:345px}}.spec-note{background:#FEFEF3;border-left:solid 4px #F4E925;margin:1rem -1rem;min-width:70vw;padding:8px 1rem 12px calc(1rem - 4px);width:-moz-fit-content;width:-webkit-fit-content;width:fit-content}@media (min-width: 720px){.spec-note{min-width:416px}}.spec-note>a:first-child{color:#6c6613;display:block;font:italic 11pt/18pt Cambria,"Palatino Linotype",Palatino,"Liberation Serif",serif;opacity:.6;user-select:none}.spec-todo{color:#666;margin:1em 0 1em 5em;min-height:1em}.spec-todo::before{content:"todo";display:block;float:left;margin-left:-5em;text-transform:uppercase}.spec-index ol{list-style-type:none;margin:0 0 0 var(--indent);padding:0;column-width:210px;column-gap:var(--indent)}.spec-index ol li{width:min-content;white-space:nowrap}pre,code{font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;font-size:var(--mono-font-size);font-weight:inherit}code{background:rgba(0,0,0,.03);margin:-2px -1px;padding:3px 3px;white-space:pre-wrap}pre>code{background:none;font-weight:inherit;margin:0;padding:0;white-space:pre}pre{background:#FAFAFA;border-left:solid 4px #E9E9E9;margin:1rem -1rem;min-width:70vw;padding:12px 1rem 12px calc(1rem - 4px);width:-moz-fit-content;width:-webkit-fit-content;width:fit-content;max-width:calc(100vw - 2rem);overflow-y:scroll}@media (min-width: 720px){pre{min-width:40ch}}.spec-example{background:#FAFAFF;border-left:solid 4px #BBBBFF;padding-top:8px}.spec-counter-example{background:#FFFAFA;border-left:solid 4px #FFBBBB;padding-top:8px}.spec-example>a,.spec-counter-example>a{display:block;font:italic 11pt/18pt Cambria,"Palatino Linotype",Palatino,"Liberation Serif",serif;opacity:.6;user-select:none}.spec-counter-example>a{color:#98593b}table{border-collapse:collapse}th{background-color:#f9f9f9}td,th{border:1px solid #D0D0D0;padding:.4em;vertical-align:baseline}ol,ul{padding-left:var(--list-indent)}li>ol,li>ul{margin-top:.25em;margin-bottom:.5em}li+li{margin-top:.25em}li.task{list-style-type:none;position:relative}li.task>input:first-child{margin-left:0;position:absolute;transform:translateX(calc(-100% - 1ch))}ins{background-color:#00c81e14;text-decoration:none}del{background-color:#c8000014}.spec-added,.spec-removed{border-left:4px solid;margin-left:-18px;padding-left:14px}.spec-added{border-color:#396}.spec-removed{border-color:#933;text-decoration:line-through}.spec-keyword{font-weight:bold}.spec-string{font-family:Consolas,Monaco,monospace;font-size:85%;white-space:pre}var{font-style:italic}*[data-name]{transition:.15s background ease-out;border-radius:2px;padding:0 3px;margin:0 -3px}.spec-semantic,.spec-algo{margin:1rem 0 1rem var(--dfn-indent)}.spec-semantic>.spec-nt::after,.spec-algo>.spec-call:first-child::after{content:":";font-style:normal;font-weight:bold;margin-left:1ex}.spec-semantic ol,.spec-semantic ol ol ol ol,.spec-algo ol,.spec-algo ol ol ol ol{list-style-type:decimal}.spec-semantic ol ol,.spec-semantic ol ol ol ol ol,.spec-algo ol ol,.spec-algo ol ol ol ol ol{list-style-type:lower-alpha}.spec-semantic ol ol ol,.spec-semantic ol ol ol ol ol ol,.spec-algo ol ol ol,.spec-algo ol ol ol ol ol ol{list-style-type:lower-roman}.spec-call>a{color:inherit}.spec-production{margin:1rem 0 1rem var(--dfn-indent)}.spec-production>.spec-nt::after{content:":";font-style:normal;font-weight:bold;margin:0 1ex}.spec-semantic.d2>.spec-nt::after,.spec-production.d2>.spec-nt::after{content:"::"}.spec-semantic.d3>.spec-nt::after,.spec-production.d3>.spec-nt::after{content:":::"}.spec-production>.spec-rhs{line-height:1.1;margin:.25em 0 .5em calc(2 * var(--indent));text-indent:calc(-1 * var(--indent))}.spec-semantic>.spec-rhs{display:inline-block;text-indent:calc(-1 * var(--indent));margin-left:calc(1ex + var(--indent))}.spec-rhs>*{text-indent:0}.spec-oneof{display:inline}.spec-oneof::before{content:"one of";font-style:normal;font-weight:bold}.spec-oneof-grid{max-width:calc(100vw - 2rem);overflow:scroll;margin:-1ex -1rem;padding:1ex 1rem}.spec-oneof-grid>table{margin-left:var(--indent)}.spec-oneof .spec-rhs{border:none;margin:0;padding:0 0 0 1rem;vertical-align:baseline;white-space:pre}.spec-oneof .spec-rhs:first-child{padding:0}.spec-rhs .spec-constrained:not(:first-child),.spec-rhs .spec-quantified:not(:first-child),.spec-rhs .spec-nt:not(:first-child),.spec-rhs .spec-t:not(:first-child),.spec-rhs .spec-rx:not(:first-child),.spec-rhs .spec-prose:not(:first-child),.spec-rhs .spec-empty:not(:first-child),.spec-rhs .spec-lookahead:not(:first-child){margin-left:1ex;display:inline-block}.spec-condition{font-size:85%}.spec-condition::before{content:"[if "}.spec-condition.not::before{content:"[if not "}.spec-condition::after{content:"]"}.spec-empty,.spec-prose{color:#666}.spec-nt{font-style:italic}.spec-nt>a{color:inherit}.spec-quantifiers,.spec-params{font-size:65%;font-style:normal;vertical-align:sub}.spec-quantifier.list{color:#3348d3}.spec-quantifier.optional{color:#83238e}.spec-params,.spec-condition{color:#1c7758}.spec-params::before{content:"["}.spec-params::after{content:"]"}.spec-quantifier:not(:last-child)::after,.spec-param:not(:last-child)::after{color:#666;content:", "}.spec-param.conditional::before{content:"?"}.spec-param.negated::before{content:"!"}.spec-t,.spec-rx{color:#333;font-family:monospace;font-weight:bold}.spec-butnot::before{color:#666;content:"but not";font-family:Cambria,"Palatino Linotype",Palatino,"Liberation Serif",serif;font-weight:normal;margin-right:1ex}.spec-butnot>*:not(:first-child)::before{color:#666;content:"or";font-family:Cambria,"Palatino Linotype",Palatino,"Liberation Serif",serif;font-weight:normal;margin-right:1ex}.spec-rhs .spec-oneof::before,.spec-rhs .spec-butnot::before{margin-left:1ex}.spec-lookahead>*{margin:0!important}.spec-lookahead>*:not(:first-child)::before{color:#666;content:", ";font-family:Cambria,"Palatino Linotype",Palatino,"Liberation Serif",serif;font-style:normal;font-weight:normal}.spec-lookahead::before{color:#666;content:"[lookahead = ";font-family:Cambria,"Palatino Linotype",Palatino,"Liberation Serif",serif;font-style:normal;font-weight:normal}.spec-lookahead.not::before{content:"[lookahead \2260  "}.spec-lookahead.set::before{content:"[lookahead \2208  {";margin-right:0}.spec-lookahead.set.not::before{content:"[lookahead \2209  {"}.spec-lookahead.ntset::before{content:"[lookahead \2208  ";margin-right:0}.spec-lookahead.ntset.not::before{content:"[lookahead \2209  "}.spec-lookahead::after{color:#666;content:"]"}.spec-lookahead.set::after{content:"}]"}.token.atrule,.token.attr-value,.token.keyword,.token.property,.token.selector,.token.attr-name,.token.builtin,.token.entity,.token.url,.token.inserted{color:#1b1994b0;background:none}.token.tag,.token.boolean,.token.number,.token.string,.token.char,.token.constant,.token.symbol,.token.regex,.token.important,.token.variable,.token.function,.token.class-name,.token.deleted{color:#a20764bd}.token.comment,.token.prolog,.token.doctype,.token.cdata,.token.description{color:inherit;opacity:.3}.token.punctuation{color:inherit;opacity:.5}.token.operator,.token.namespace{color:inherit;opacity:.7}</style>
<script>(function(){var r,a=[];document.addEventListener("readystatechange",function(){document.readyState==="interactive"&&u()});function u(){var n=document.querySelector('label[for="spec-sidebar-toggle"]');n.addEventListener("scroll",o),n.addEventListener("touchmove",o);function o(d){d.preventDefault()}for(var t=document.getElementsByTagName("section"),e=0;e<t.length;e++)t[e].getAttribute("secid")&&a.push(t[e]);var i=window.scrollY,c=!1;window.addEventListener("scroll",function(d){i=window.scrollY,c||(c=!0,window.requestAnimationFrame(function(){s(i),c=!1}))})}function s(n){for(var o=n+document.documentElement.clientHeight/4,t,e=a.length-1;e>=0;e--)if(a[e].offsetTop<o){t=a[e];break}var i=t&&t.getAttribute("secid");i!==r&&(r&&l(r,!1),i&&l(i,!0),r=i)}function l(n,o){document.getElementById("_sidebar_"+n).className=o?"viewing":"";for(var t=n.split(".");t.length;){var e=document.getElementById("_toggle_"+t.join("."));e&&(e.checked=o),t.pop()}}s(window.scrollY);})();</script>
<script>(function(){var n=document.getElementsByTagName("style")[0].sheet,e;function u(){e&&(n.deleteRule(e),e=void 0)}function d(t){u(),e=n.insertRule('*[data-name="'+t+'"] { background: rgba(230,215,0,0.12); }',n.cssRules.length)}document.documentElement.addEventListener("mouseover",function(t){var a=t.target.attributes["data-name"];a&&d(a.value)});document.documentElement.addEventListener("mouseout",u);})();</script>
<script>(function(){var R="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",o,p,r,g;document.addEventListener("selectionchange",E);window.addEventListener("resize",C);window.addEventListener("hashchange",x);window.addEventListener("load",x);function S(n){y(new URL(n.target.href))}function x(){y(window.location)}function y(n){var e=n.hash.match(/^#sel-([A-Za-z0-9-_]+)$/);if(!!e){g=e[1],r=k(g);var t=r.getBoundingClientRect(),d=Math.max(20,Math.floor((window.innerHeight-t.height)*.4));window.scrollTo(0,window.scrollY+t.y-d);var c=document.getSelection();c.empty(),c.addRange(r),C()}}function E(n){var e=document.getSelection();if(e.isCollapsed)o&&(o.parentNode.removeChild(o),o=null);else{var t=e.getRangeAt(0);(!r||t.compareBoundaryPoints(Range.START_TO_START,r)!==0||t.compareBoundaryPoints(Range.END_TO_END,r)!==0)&&(r=t,g=B(r),C())}}function C(){if(!!r){p||(p=document.getElementsByTagName("article")[0]),o||(o=document.createElement("a"),document.body.appendChild(o)),o.href="#sel-"+g,o.onclick=S,o.className=r.isOutdated?"outdated-selection-link":"selection-link",o.innerText=r.isOutdated?"!":"\u201F";var n=window.innerWidth<720,e=r.getBoundingClientRect();if(n)o.style.left=Math.floor(e.x+e.width/2+window.scrollX-13)+"px",o.style.top=Math.floor(e.bottom+window.scrollY+10)+"px";else{var t=p.getBoundingClientRect().x;o.style.left=Math.floor(t+window.scrollX-37)+"px",o.style.top=Math.floor(e.y+window.scrollY-3)+"px"}}}function B(n){var e="",t=N(n.startContainer),d=N(n.endContainer),c=M(t,d);return l(c),l(t.slice(c.length).concat(n.startOffset)),l(d.slice(c.length).concat(n.endOffset)),i(L(n.toString())),e;function i(a){do e+=R[a&31|(a>31?32:0)],a>>=5;while(a>0)}function l(a){i(a.length);for(var h=0;h<a.length;h++)i(a[h])}}function k(n){for(var e=new Array(64),t=0;t<64;t++)e[R.charCodeAt(t)]=t;var d=0,c=m(),i=m(),l=m(),a=w(),h=i.pop(),P=O(c.concat(i)),T=l.pop(),A=O(c.concat(l)),u=document.createRange();return u.setStart(P,h),u.setEnd(A,T),u.isOutdated=a!==void 0&&a!==L(u.toString()),u;function w(){for(var s=0,v=0;d<n.length;){var f=e[n.charCodeAt(d++)];if(s|=(f&31)<<v,v+=5,f<32)return s}}function m(){var s=w();if(s!=null){for(var v=new Array(s),f=0;f<s;f++)v[f]=w();return v}}}function N(n){for(var e=[];n!=document.body;){var t=n.parentNode;e.push(Array.prototype.indexOf.call(t.childNodes,n)),n=t}return e.reverse()}function O(n){for(var e=document.body,t=0;t<n.length&&e;t++)e=e.childNodes[n[t]];return e}function M(n,e){for(var t=0;t<n.length&&t<e.length&&n[t]===e[t];)t++;return n.slice(0,t)}function L(n){for(var e=2166136261,t=0;t<n.length;++t)e^=n.charCodeAt(t),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return(e>>15^e)&32767}})();</script>
</head>
<body><article>
<header>
<h1>GraphQL Continuations</h1>
<section id="intro">
<p>This document aims to define an additional approach of pre-fetching and loading portions of a GraphQL query taking longer than the client deems an acceptable amount of time, with similar intentions as the <code>@defer</code> directive.</p>
<p>It does this with a pattern of adding a <code>continuation</code> field to an Object type, resolving with a Union containing either the result selection of fields for the parent type, or a unique identifier used by the the client to fetch and resolve the completed selection set at some point in the future after the initial response is returned.</p>
<section id="sec-Goals-" class="subsec">
<h6><a href="#sec-Goals-" title="link to this subsection">Goals:</a></h6>
<ol>
<li>Modeled in pure GraphQL Object &amp; Union types, no directives or schema extensions</li>
<li>Well suited for simple server side rendering (SSR), or other means of state pre-hydration</li>
<li>Keep the GraphQL execution response stateless, externalizing state for simpler client consumption</li>
<li>Allows the client to define acceptable wait times per continuation, to return full responses immediately if available, eliminating unnecessary loading states caused by incomplete results</li>
</ol>
<div id="note-0287b" class="spec-note">
<a href="#note-0287b">Note</a>
 A GraphQL Continuation relies on a server implementation with an runtime equivalent to JavaScript&rsquo;s <code>Promise.race</code></div>
</section>
</section>
<nav class="spec-toc">
<div class="title">Contents</div>
<ol>
<li><a href="#sec-Overview"><span class="spec-secid">1</span>Overview</a><ol>
<li><a href="#sec-Example-Scenario"><span class="spec-secid">1.1</span>Example Scenario</a></li>
<li><a href="#sec-Performance-Visualization"><span class="spec-secid">1.2</span>Performance Visualization</a></li>
</ol>
</li>
<li><a href="#sec-Example-Usage"><span class="spec-secid">2</span>Example Usage</a></li>
<li><a href="#sec-Implementation"><span class="spec-secid">3</span>Implementation</a><ol>
<li><a href="#sec-On-the-Query-type"><span class="spec-secid">3.1</span>On the Query type</a></li>
<li><a href="#sec-On-the-Node-Type"><span class="spec-secid">3.2</span>On the Node Type</a></li>
<li><a href="#sec-Additional-Considerations"><span class="spec-secid">3.3</span>Additional Considerations</a></li>
</ol>
</li>
<li><a href="#sec-Continuation-Field"><span class="spec-secid">4</span>Continuation Field</a></li>
<li><a href="#sec-Continuation-Type"><span class="spec-secid">5</span>Continuation Type</a></li>
<li><a href="#sec-resolveContinuation-Query-Field"><span class="spec-secid">6</span>resolveContinuation Query Field</a></li>
<li><a href="#sec-Continuation-Union-Types"><span class="spec-secid">7</span>Continuation Union Types</a></li>
<li><a href="#sec-Multiple-Nested-Continuation-Fields"><span class="spec-secid">8</span>Multiple &amp; Nested Continuation Fields</a></li>
<li><a href="#sec-Storing-Resolving-Continuation-State"><span class="spec-secid">9</span>Storing &amp; Resolving Continuation State</a><ol>
<li><a href="#sec-Example-Using-Redis-"><span class="spec-secid">9.1</span>Example Using Redis:</a></li>
</ol>
</li>
<li><a href="#sec-Use-in-Client-Libraries"><span class="spec-secid">10</span>Use in Client Libraries</a></li>
<li><a href="#index"><span class="spec-secid">§</span>Index</a></li>
</ol>
</nav>
</header>
<section id="sec-Overview" secid="1">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Overview">1</a></span>Overview</h1>
<section id="sec-Example-Scenario" secid="1.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Example-Scenario">1.1</a></span>Example Scenario</h2>
<p>Let&rsquo;s start with the following example query:</p>
<pre data-language="graphql"><code><span class="token keyword">query</span> <span class="token definition-query function">PostPage</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment"># 2-9ms resolve execution</span>
  <span class="token object">viewer</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 7-10ms resolve execution</span>
  <span class="token property-query">post</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
    <span class="token comment"># 100-2000ms resolve execution</span>
    <span class="token object">statisticsService</span> <span class="token punctuation">{</span>
      <span class="token property">likes</span>
      <span class="token property">analytics</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In this example, resolving the source type for <code>viewer</code> &amp; <code>post</code> typically takes &lt; 10ms, while the <code>statisticsService</code> takes somewhere between 100ms and 2 seconds, depending on network &amp; server conditions. This means in some cases, it will take up multiple seconds to resolve the GraphQL response.</p>
<p>Assuming no changes to improve the underlying <code>statisticsService</code>, there are a few options we have for providing a better user experience for the client:</p>
<section id="sec-Example-Scenario.Option-1-Multiple-Queries" class="subsec">
<h6><a href="#sec-Example-Scenario.Option-1-Multiple-Queries" title="link to this subsection">Option #1: Multiple Queries</a></h6>
<pre data-language="graphql"><code><span class="token keyword">query</span> <span class="token definition-query function">PostPage</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token object">viewer</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
  <span class="token property-query">post</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">query</span> <span class="token definition-query function">PostPageStats</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">post</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token object">statisticsService</span> <span class="token punctuation">{</span>
      <span class="token property">likes</span>
      <span class="token property">views</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</section>
<section id="sec-Example-Scenario.Option-2-defer-Directive" class="subsec">
<h6><a href="#sec-Example-Scenario.Option-2-defer-Directive" title="link to this subsection">Option #2: @defer Directive</a></h6>
<pre data-language="graphql"><code><span class="token keyword">query</span> <span class="token definition-query function">PostPage</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token object">viewer</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
  <span class="token property-query">post</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
    <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">Post</span> <span class="token directive function">@defer</span> <span class="token punctuation">{</span>
      <span class="token object">statisticsService</span> <span class="token punctuation">{</span>
        <span class="token property">likes</span>
        <span class="token property">views</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</section>
<section id="sec-Example-Scenario.Option-3-The-continuation-field" class="subsec">
<h6><a href="#sec-Example-Scenario.Option-3-The-continuation-field" title="link to this subsection">Option #3: The continuation field</a></h6>
<pre data-language="graphql"><code><span class="token keyword">query</span> <span class="token definition-query function">PostPage</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token object">viewer</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
  <span class="token property-query">post</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
    <span class="token property-query">continuation</span><span class="token punctuation">(</span><span class="token attr-name">waitMs</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token property">__typename</span>
      <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">Continuation</span> <span class="token punctuation">{</span>
        <span class="token property">continuationId</span>
      <span class="token punctuation">}</span>
      <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>
        <span class="token property">id</span>
        <span class="token object">statisticsService</span> <span class="token punctuation">{</span>
          <span class="token property">likes</span>
          <span class="token property">views</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In this third example, if the result of the fields nested beneath <code>continuation</code> resolves in under 200ms, the response will resolve immediately with the fields nested beneath the <code>continuation</code> field:</p>
<pre data-language="json"><code><span class="token punctuation">{</span>
  <span class="token property">"viewer"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"Vmlld2VyOjE="</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"User"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"post"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"UG9zdDox"</span><span class="token punctuation">,</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Continuation Spec"</span><span class="token punctuation">,</span>
    <span class="token property">"continuation"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"__typename"</span><span class="token operator">:</span> <span class="token string">"Post"</span><span class="token punctuation">,</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"UG9zdDox"</span><span class="token punctuation">,</span>
      <span class="token property">"statisticsService"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"likes"</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        <span class="token property">"views"</span><span class="token operator">:</span> <span class="token number">20000</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Otherwise the field will resolve in 200ms with a Continuation type, including <code>continuationId</code>, a server provided identifier used by the client to fetch the eventual resolved result fields:</p>
<pre data-language="json"><code><span class="token punctuation">{</span>
  <span class="token property">"viewer"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"Vmlld2VyOjE="</span><span class="token punctuation">,</span> <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"User"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"post"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"UG9zdDox"</span><span class="token punctuation">,</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Continuation Spec"</span><span class="token punctuation">,</span>
    <span class="token property">"continuation"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"__typename"</span><span class="token operator">:</span> <span class="token string">"Continuation"</span><span class="token punctuation">,</span>
      <span class="token property">"continuationId"</span><span class="token operator">:</span> <span class="token string">"78bcc330-5747-40a3-81b3-980b43369dba"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</section>
</section>
<section id="sec-Performance-Visualization" secid="1.2">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Performance-Visualization">1.2</a></span>Performance Visualization</h2>
<p>The charts are meant to portray a rough, back of the napkin visualization of the time sequence of different operations:</p>
<p><img src="./charts.svg" alt="Visualized"/></p>
</section>
</section>
<section id="sec-Example-Usage" secid="2">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Example-Usage">2</a></span>Example Usage</h1>
<div id="note-9a9b1" class="spec-note">
<a href="#note-9a9b1">Note</a>
 This follows up on the Overview section above, please read that first for better context about what is happening here:</div>
<pre data-language="graphql"><code><span class="token keyword">fragment</span> <span class="token fragment function">PostContinuationResult</span> <span class="token keyword">on</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>
  <span class="token property">__typename</span>
  <span class="token property">id</span>
  <span class="token object">statisticsService</span> <span class="token punctuation">{</span>
    <span class="token property">likes</span>
    <span class="token property">views</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">query</span> <span class="token definition-query function">PostPage</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token object">viewer</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
  <span class="token object">post</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
    <span class="token property-query">continuation</span><span class="token punctuation">(</span><span class="token attr-name">waitMs</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token property">__typename</span>
      <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">Continuation</span> <span class="token punctuation">{</span>
        <span class="token property">continuationId</span>
      <span class="token punctuation">}</span>
      <span class="token operator">...</span><span class="token fragment function">PostContinuationResult</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">query</span> <span class="token definition-query function">ResolvePostPageContinuation</span><span class="token punctuation">(</span><span class="token variable">$continuationId</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">resolveContinuation</span><span class="token punctuation">(</span><span class="token attr-name">continuationId</span><span class="token punctuation">:</span> <span class="token variable">$continuationId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token fragment function">PostContinuationResult</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<div id="note-07980" class="spec-note">
<a href="#note-07980">Note</a>
 The below is meant as pseudocode, with <code>useQuery</code> representing a generic React hook from a Client like Urql, Apollo, React Query, or a vanilla fetch call.</div>
<pre data-language="jsx"><code><span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PostComponent</span></span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> isLoading<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token string">"PostPage"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HeaderComponent</span></span> <span class="token attr-name">viewer</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token property-access">viewer</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PostComponent</span></span> <span class="token attr-name">post</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token property-access">post</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PostStatsComponent</span></span> <span class="token attr-name">post</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token property-access">post</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">PostStatsComponent</span></span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> isLoading<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContinuationResult</span><span class="token punctuation">(</span>
    <span class="token string">"ResolvePostPageContinuation"</span><span class="token punctuation">,</span>
    post<span class="token punctuation">.</span><span class="token property-access">continuation</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isLoading<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Spinner</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Again, pseduocode, giving an example of how a useContinuationResult hook might work in a client</span>
<span class="token comment">// to refetch:</span>
<span class="token keyword">function</span> <span class="token function">useContinuationResult</span><span class="token punctuation">(</span><span class="token parameter">operation<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isLoading<span class="token punctuation">,</span> setIsLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token property-access">__typename</span> <span class="token operator">!==</span> <span class="token string">"Continuation"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>continuationData<span class="token punctuation">,</span> setContinuationData<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>
    obj<span class="token punctuation">.</span><span class="token property-access">__typename</span> <span class="token operator">!==</span> <span class="token string">"Continuation"</span> <span class="token operator">?</span> obj <span class="token operator">:</span> <span class="token keyword null nil">null</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token property-access">__typename</span> <span class="token operator">===</span> <span class="token string">"Continuation"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token function">fetchOperation</span><span class="token punctuation">(</span>operation<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">continuationId</span><span class="token operator">:</span> obj<span class="token punctuation">.</span><span class="token property-access">continuationId</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          setIsLoading<span class="token punctuation">;</span>
          <span class="token function">setContinuation</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">setError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> isLoading<span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> continuationData<span class="token punctuation">,</span> error <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</section>
<section id="sec-Implementation" secid="3">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Implementation">3</a></span>Implementation</h1>
<p>A continuation field relies on being able to execute the <code>selectionSet</code> beneath the continuation selection as a root Query.</p>
<section id="sec-On-the-Query-type" secid="3.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-On-the-Query-type">3.1</a></span>On the Query type</h2>
<p>Taking the following query:</p>
<pre data-language="graphql"><code><span class="token keyword">query</span> <span class="token definition-query function">RootLevelQuery</span> <span class="token punctuation">{</span>
  <span class="token object">viewer</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
  <span class="token object">slowRemoteQueryField</span> <span class="token punctuation">{</span>
    <span class="token property">data</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Adding a <code>continuation</code> field to early return before the completion of <code>slowRemoteQueryField</code></p>
<pre data-language="graphql"><code><span class="token keyword">query</span> <span class="token definition-query function">RootLevelQuery</span> <span class="token punctuation">{</span>
  <span class="token object">viewer</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
  <span class="token object">continuation</span> <span class="token punctuation">{</span>
    <span class="token property">__typename</span>
    <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">Continuation</span> <span class="token punctuation">{</span>
      <span class="token property">continuationId</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
      <span class="token object">slowRemoteQueryField</span> <span class="token punctuation">{</span>
        <span class="token property">data</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The selection set below the <code>Query</code> fragment is collected and re-executed as a separate query:</p>
<pre data-language="graphql"><code><span class="token keyword">query</span> <span class="token definition-query function">ExecutedContinuationQuery</span> <span class="token punctuation">{</span>
  <span class="token object">slowRemoteQueryField</span> <span class="token punctuation">{</span>
    <span class="token property">data</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>and the result is associated with the identifier returned to the client as <code>continuationId</code>.</p>
</section>
<section id="sec-On-the-Node-Type" secid="3.2">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-On-the-Node-Type">3.2</a></span>On the Node Type</h2>
<p>Schemas implementing the Relay specification provide a root level &ldquo;node&rdquo; field, making it straightforward to implement a <code>continuation</code> field:</p>
<pre data-language="graphql"><code><span class="token keyword">fragment</span> <span class="token fragment function">PostContinuationResult</span> <span class="token keyword">on</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>
  <span class="token property">__typename</span>
  <span class="token property">id</span>
  <span class="token object">statisticsService</span> <span class="token punctuation">{</span>
    <span class="token property">likes</span>
    <span class="token property">views</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">query</span> <span class="token definition-query function">PostPage</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token object">viewer</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
  <span class="token object">post</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
    <span class="token property-query">continuation</span><span class="token punctuation">(</span><span class="token attr-name">waitMs</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token property">__typename</span>
      <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">Continuation</span> <span class="token punctuation">{</span>
        <span class="token property">continuationId</span>
      <span class="token punctuation">}</span>
      <span class="token operator">...</span><span class="token fragment function">PostContinuationResult</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The executed query associated with <code>continuationId</code>:</p>
<pre data-language="graphql"><code><span class="token keyword">query</span> <span class="token definition-query function">ExcecutedContinuationQuery</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property-query">node</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token fragment function">PostContinuationResult</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</section>
<section id="sec-Additional-Considerations" secid="3.3">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Additional-Considerations">3.3</a></span>Additional Considerations</h2>
<p>Object types other than Query &amp; types implementing the Node interface may add a continuation field, however the applications will be responsible for defining the query &amp; variables used to</p>
</section>
</section>
<section id="sec-Continuation-Field" secid="4">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Continuation-Field">4</a></span>Continuation Field</h1>
<p>A Continuation field may only be defined on an Object type, and should contain an argument, <code>waitMs</code>. This argument <em>may</em> have a default value, which can different for each implementation of the <code>continuation</code> field.</p>
<pre data-language="graphql"><code><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
  <span class="token attr-name">continuation</span><span class="token punctuation">(</span><span class="token attr-name">waitMs</span><span class="token punctuation">:</span> <span class="token scalar">Int</span> <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">QueryContinuation</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It <em>may</em> contain additional arguments, to adjust the field&rsquo;s resolve behavior</p>
<p>A continuation field <strong>must</strong> and return a union type containing the Union type of the field&rsquo;s parent type, and the <a href="#sec-Continuation-Type">Continuation type</a>.</p>
<pre data-language="graphql"><code><span class="token keyword">union</span> <span class="token class-name">QueryContinuation</span> <span class="token operator">=</span> <span class="token property">Continuation</span> <span class="token operator">|</span> <span class="token property">Query</span>
</code></pre>
<p>The type of a continuation field may also be non-null</p>
<pre data-language="graphql"><code><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
  <span class="token attr-name">continuation</span><span class="token punctuation">(</span><span class="token attr-name">waitMs</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span> <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">QueryContinuation</span><span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre>
<p>There is no restriction on the name of the continuation type, however a common pattern is to concat the parent type + Continuation</p>
</section>
<section id="sec-Continuation-Type" secid="5">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Continuation-Type">5</a></span>Continuation Type</h1>
<p>The Continuation type <strong>must</strong> be an Object type containing a single field, <code>continuationId</code>.</p>
<pre data-language="graphql"><code><span class="token keyword">type</span> <span class="token class-name">Continuation</span> <span class="token punctuation">{</span>
  <span class="token attr-name">continuationId</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It may contain additional fields, for example if <code>resolveContinuation</code> were to returns an additional Continuation with progress information:</p>
<pre data-language="graphql"><code><span class="token keyword">type</span> <span class="token class-name">Continuation</span> <span class="token punctuation">{</span>
  <span class="token attr-name">continuationId</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span>
  <span class="token attr-name">progressPercentage</span><span class="token punctuation">:</span> <span class="token scalar">Int</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A Continuation type is always consumed by the client as a member of a Union type, most commonly alongside a <code>Query</code> or <code>Node</code> type.</p>
<p>The String returned for the <code>continuationId</code> to represent the eventual completion is left to the application. See <a href="#sec-Storing-Resolving-Continuation-State">storing &amp; resolving continuation state</a> for an example implementation</p>
</section>
<section id="sec-resolveContinuation-Query-Field" secid="6">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-resolveContinuation-Query-Field">6</a></span>resolveContinuation Query Field</h1>
<p>A single top-level field must be defined to resolve the result of a continuation. It takes a single argument, <code>continuationId</code> and returns a Union type, representing all of the possible continuations that can be represented in the schema</p>
<pre data-language="graphql"><code><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
  <span class="token attr-name">resolveContinuation</span><span class="token punctuation">(</span><span class="token attr-name">continuationId</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">AllContinuationTypes</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It must return a union of all of the possible types containing a <code>continuation</code> field, and any</p>
</section>
<section id="sec-Continuation-Union-Types" secid="7">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Continuation-Union-Types">7</a></span>Continuation Union Types</h1>
<p>The type of a continuation field is the union of the Continuation type and the containing parent type</p>
<div class="spec-production" id="QueryContinuation">
<span class="spec-nt"><a href="#QueryContinuation" data-name="QueryContinuation">QueryContinuation</a></span><div class="spec-rhs"><span class="spec-nt"><span data-name="Query">Query</span></span><span class="spec-t">|</span><span class="spec-nt"><span data-name="Continuation">Continuation</span></span></div>
</div>
<div class="spec-production" id="UserContinuation">
<span class="spec-nt"><a href="#UserContinuation" data-name="UserContinuation">UserContinuation</a></span><div class="spec-rhs"><span class="spec-nt"><span data-name="User">User</span></span><span class="spec-t">|</span><span class="spec-nt"><span data-name="Continuation">Continuation</span></span></div>
</div>
<p>The type of the <code>resolveContinuation</code> field is the union of all types in the schema with a continuation field</p>
<div class="spec-production" id="ResolveContinuationResult">
<span class="spec-nt"><a href="#ResolveContinuationResult" data-name="ResolveContinuationResult">ResolveContinuationResult</a></span><div class="spec-rhs"><span class="spec-nt"><span data-name="Query">Query</span></span><span class="spec-t">|</span><span class="spec-nt"><span data-name="User">User</span></span></div>
</div>
<p>It may optionally include the Continuation type in the union, allowing resolving with a further continuation</p>
<div class="spec-production" id="ResolveContinuationResult">
<span class="spec-nt"><a href="#ResolveContinuationResult" data-name="ResolveContinuationResult">ResolveContinuationResult</a></span><div class="spec-rhs"><span class="spec-nt"><span data-name="Query">Query</span></span><span class="spec-t">|</span><span class="spec-nt"><span data-name="User">User</span></span><span class="spec-t">|</span><span class="spec-nt"><span data-name="Continuation">Continuation</span></span></div>
</div>
</section>
<section id="sec-Multiple-Nested-Continuation-Fields" secid="8">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Multiple-Nested-Continuation-Fields">8</a></span>Multiple &amp; Nested Continuation Fields</h1>
<p>Continuation fields follow the same rules as other GraphQL fields, meaning they can be aliased</p>
<pre data-language="graphql"><code><span class="token keyword">fragment</span> <span class="token fragment function">ContinuationFragment</span> <span class="token keyword">on</span> <span class="token class-name">Continuation</span> <span class="token punctuation">{</span>
  <span class="token property">continuationId</span>
<span class="token punctuation">}</span>

<span class="token keyword">query</span> <span class="token definition-query function">MultipleContinuations</span> <span class="token punctuation">{</span>
  <span class="token object">viewer</span> <span class="token punctuation">{</span>
    <span class="token property">id</span>
    <span class="token property">name</span>
  <span class="token punctuation">}</span>
  <span class="token attr-name">statsInfo</span><span class="token punctuation">:</span> <span class="token property-query">continuation</span><span class="token punctuation">(</span><span class="token attr-name">waitMs</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">__typename</span>
    <span class="token operator">...</span><span class="token fragment function">ContinuationFragment</span>
    <span class="token operator">...</span><span class="token fragment function">StatsPanel</span>
  <span class="token punctuation">}</span>
  <span class="token attr-name">offScreenData</span><span class="token punctuation">:</span> <span class="token property-query">continuation</span><span class="token punctuation">(</span><span class="token attr-name">waitMs</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token property">__typename</span>
    <span class="token operator">...</span><span class="token fragment function">ContinuationFragment</span>
    <span class="token operator">...</span><span class="token fragment function">FooterInfo</span>
    <span class="token operator">...</span><span class="token fragment function">LowerSectionRecommendations</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It is likewise possible to nest continuations below continuations</p>
<pre data-language="graphql"><code><span class="token keyword">fragment</span> <span class="token fragment function">NestedContinuationExample</span> <span class="token keyword">on</span> <span class="token class-name">QueryContinuation</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token fragment function">ContinuationFragment</span>
  <span class="token object">slowRecommendationStats</span> <span class="token punctuation">{</span>
    <span class="token property">data</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fragment</span> <span class="token fragment function">LowerSectionRecommendations</span> <span class="token keyword">on</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
  <span class="token property-query">recommendations</span><span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token object">nodes</span> <span class="token punctuation">{</span>
      <span class="token property">title</span>
      <span class="token property">message</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token attr-name">stats</span><span class="token punctuation">:</span> <span class="token property-query">continuation</span><span class="token punctuation">(</span><span class="token attr-name">waitMs</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token fragment function">NestedContinuationExample</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</section>
<section id="sec-Storing-Resolving-Continuation-State" secid="9">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Storing-Resolving-Continuation-State">9</a></span>Storing &amp; Resolving Continuation State</h1>
<p>This specification intentionally does not define the behavior around the formation of <code>continuationId</code>, whether they can be used one or multiple times, or the expiry of state behind these IDs.</p>
<section id="sec-Example-Using-Redis-" secid="9.1">
<h2><span class="spec-secid" title="link to this section"><a href="#sec-Example-Using-Redis-">9.1</a></span>Example Using Redis:</h2>
<div class="spec-todo">
Example for Redis</div>
</section>
</section>
<section id="sec-Use-in-Client-Libraries" secid="10">
<h1><span class="spec-secid" title="link to this section"><a href="#sec-Use-in-Client-Libraries">10</a></span>Use in Client Libraries</h1>
<p>One consideration for clients is the merging of schemas when utilizing document caching. It would be useful to update the state of the original document returning the continuation </p>
</section>
<section id="index" secid="index" class="spec-index">
<h1>
<span class="spec-secid" title="link to the index"><a href="#index">§</a></span>Index</h1>
<ol>
<li><a href="#QueryContinuation">QueryContinuation</a></li>
<li><a href="#ResolveContinuationResult">ResolveContinuationResult</a></li>
<li><a href="#UserContinuation">UserContinuation</a></li>
</ol>
</section>
</article>
<footer>
Written in <a href="https://spec-md.com" target="_blank">Spec Markdown</a>.</footer>
<input hidden class="spec-sidebar-toggle" type="checkbox" id="spec-sidebar-toggle" aria-hidden /><label for="spec-sidebar-toggle" aria-hidden><div class="spec-sidebar-button">&#x2630;</div></label>
<div class="spec-sidebar" aria-hidden>
<div class="spec-toc">
<div class="title"><a href="#">GraphQL Continuations</a></div>
<ol><li id="_sidebar_1"><a href="#sec-Overview"><span class="spec-secid">1</span>Overview</a>
<input hidden class="toggle" type="checkbox" id="_toggle_1" /><label for="_toggle_1"></label>
<ol>
<li id="_sidebar_1.1"><a href="#sec-Example-Scenario"><span class="spec-secid">1.1</span>Example Scenario</a></li>
<li id="_sidebar_1.2"><a href="#sec-Performance-Visualization"><span class="spec-secid">1.2</span>Performance Visualization</a></li>
</ol>
</li>
<li id="_sidebar_2"><a href="#sec-Example-Usage"><span class="spec-secid">2</span>Example Usage</a></li>
<li id="_sidebar_3"><a href="#sec-Implementation"><span class="spec-secid">3</span>Implementation</a>
<input hidden class="toggle" type="checkbox" id="_toggle_3" /><label for="_toggle_3"></label>
<ol>
<li id="_sidebar_3.1"><a href="#sec-On-the-Query-type"><span class="spec-secid">3.1</span>On the Query type</a></li>
<li id="_sidebar_3.2"><a href="#sec-On-the-Node-Type"><span class="spec-secid">3.2</span>On the Node Type</a></li>
<li id="_sidebar_3.3"><a href="#sec-Additional-Considerations"><span class="spec-secid">3.3</span>Additional Considerations</a></li>
</ol>
</li>
<li id="_sidebar_4"><a href="#sec-Continuation-Field"><span class="spec-secid">4</span>Continuation Field</a></li>
<li id="_sidebar_5"><a href="#sec-Continuation-Type"><span class="spec-secid">5</span>Continuation Type</a></li>
<li id="_sidebar_6"><a href="#sec-resolveContinuation-Query-Field"><span class="spec-secid">6</span>resolveContinuation Query Field</a></li>
<li id="_sidebar_7"><a href="#sec-Continuation-Union-Types"><span class="spec-secid">7</span>Continuation Union Types</a></li>
<li id="_sidebar_8"><a href="#sec-Multiple-Nested-Continuation-Fields"><span class="spec-secid">8</span>Multiple &amp; Nested Continuation Fields</a></li>
<li id="_sidebar_9"><a href="#sec-Storing-Resolving-Continuation-State"><span class="spec-secid">9</span>Storing &amp; Resolving Continuation State</a>
<input hidden class="toggle" type="checkbox" id="_toggle_9" /><label for="_toggle_9"></label>
<ol>
<li id="_sidebar_9.1"><a href="#sec-Example-Using-Redis-"><span class="spec-secid">9.1</span>Example Using Redis:</a></li>
</ol>
</li>
<li id="_sidebar_10"><a href="#sec-Use-in-Client-Libraries"><span class="spec-secid">10</span>Use in Client Libraries</a></li>
<li id="_sidebar_index"><a href="#index"><span class="spec-secid">§</span>Index</a></li>
</ol>
</div>
</div>
</body>
</html>
